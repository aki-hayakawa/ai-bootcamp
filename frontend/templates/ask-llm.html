{% extends "base.html" %}
{% block title %}Ask LLM{% endblock %}
{% block content %}
  <h2>Ask the LLM</h2>

  <div class="mb-3">
    <label for="prompt" class="form-label">Prompt</label>
    <textarea id="prompt" class="form-control" rows="4"></textarea>
  </div>
  <button id="submitBtn" class="btn btn-primary">Submit</button>

  <hr>
  <div id="response-container" style="display: none;">
    <h4>Response (<span id="source"></span>)</h4>
    <pre class="bg-light p-3 border rounded" id="responseText"></pre>
  </div>

<script>
  window.addEventListener('DOMContentLoaded', () => {
  document.getElementById("submitBtn").addEventListener("click", async (event) => {
    event.preventDefault();
    console.log("Button clicked");

    const prompt = document.getElementById("prompt").value.trim();
    if (!prompt) {
      alert("Please enter a prompt.");
      return;
    }

    try {
      const res = await fetch("/ask-llm", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: prompt })
      });

      let data;
      try {
        data = await res.json();
      } catch (jsonError) {
        alert("Server did not return JSON.");
        return;
      }

      if (!res.ok) {
        alert(data.detail || "Error");
        return;
      }

      // âœ… Check if response and source exist
      if (data.response && data.source) {
        document.getElementById("responseText").innerText = data.response;
        document.getElementById("source").innerText = data.source;
        document.getElementById("response-container").style.display = "block";
      } else {
        alert("Unexpected response from server.");
        console.log(data); // See what the server actually returned
      }

    } catch (e) {
      alert("Error: " + e.message);
    }
  });
});

</script>

{% endblock %}
